<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Merry Christmas 2025</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000921; font-family: 'Arial', sans-serif; }

        /* å¯åŠ¨é®ç½©å±‚æ ·å¼ */
        #start-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 9, 33, 0.95);
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            z-index: 10; cursor: pointer; color: white;
            transition: opacity 1s ease;
        }

        h1 { margin: 0 0 20px 0; font-size: 2rem; text-align: center; text-shadow: 0 0 10px #fff; }

        .btn {
            padding: 15px 40px; border: 2px solid #ffd700; color: #ffd700;
            font-size: 1.2rem; border-radius: 30px; background: transparent;
            transition: 0.3s;
        }
        .btn:hover { background: #ffd700; color: #000; }

        #signature {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.6); font-size: 14px; font-family: 'Times New Roman', serif;
            pointer-events: none; z-index: 5;
        }
    </style>
</head>
<body>

<audio id="bgm" src="song.mp3" loop preload="auto"></audio>

<div id="start-overlay">
    <h1>ğŸ„ A Gift For You ğŸ„</h1>
    <div class="btn">ç‚¹å‡»å¼€å¯</div>
    <p style="margin-top:15px; font-size: 0.8rem; color: #889;">(æ»‘åŠ¨å±å¹•å¯åˆ‡æ¢è§†è§’)</p>
</div>

<div id="signature">Merry Christmas 2025</div>

<script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
    // --- 1. åœºæ™¯ä¸ç›¸æœºåˆå§‹åŒ– ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000921);
    scene.fog = new THREE.FogExp2(0x000921, 0.05);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 4, 10); // æŠ¬é«˜ä¸”æ‹‰è¿œè§†è§’

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // ä¼˜åŒ–é«˜åˆ†å±æ¸…æ™°åº¦
    document.body.appendChild(renderer.domElement);

    // è½¨é“æ§åˆ¶å™¨
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.target.set(0, 2.5, 0);
    controls.maxPolarAngle = Math.PI / 2 - 0.1;

    // --- 2. åœ£è¯æ ‘æ„å»º ---
    const treeGroup = new THREE.Group();
    scene.add(treeGroup);

    // è¾…åŠ©: åœ†å½¢çº¹ç†ç”Ÿæˆ
    function createCircleTexture() {
        const canvas = document.createElement('canvas');
        canvas.width = 32; canvas.height = 32;
        const ctx = canvas.getContext('2d');
        ctx.beginPath();
        ctx.arc(16, 16, 15, 0, Math.PI * 2);
        ctx.fillStyle = 'white';
        ctx.fill();
        return new THREE.CanvasTexture(canvas);
    }

    // æ ‘å¶ç²’å­ç³»ç»Ÿ
    const leafGeometry = new THREE.BufferGeometry();
    const leafCount = 4500;
    const leafPositions = [];
    const leafColors = [];
    const colorBase = new THREE.Color(0x4f94cc);

    for (let i = 0; i < leafCount; i++) {
        const y = Math.random() * 5.0;
        const radius = (5.0 - y) * 0.4 + 0.2;
        const angle = Math.random() * Math.PI * 2;
        const r = Math.random() * radius;

        leafPositions.push(Math.cos(angle) * r, y, Math.sin(angle) * r);

        const color = colorBase.clone();
        color.r += (Math.random() - 0.5) * 0.2;
        color.g += (Math.random() - 0.5) * 0.2;
        leafColors.push(color.r, color.g, color.b);
    }

    leafGeometry.setAttribute('position', new THREE.Float32BufferAttribute(leafPositions, 3));
    leafGeometry.setAttribute('color', new THREE.Float32BufferAttribute(leafColors, 3));

    const leafMaterial = new THREE.PointsMaterial({
        size: 0.12, vertexColors: true, transparent: true, opacity: 0.8,
        map: createCircleTexture(), depthWrite: false
    });
    treeGroup.add(new THREE.Points(leafGeometry, leafMaterial));

    // èºæ—‹è£…é¥°çº¿
    const spiralMaterial = new THREE.LineBasicMaterial({ color: 0xffdf99, linewidth: 2 });
    for(let j=0; j<5; j++) {
        const points = [];
        for(let i=0; i<=100; i++) {
            const t = i / 100;
            const y = t * 5.0;
            const r = (5.0 - y) * 0.45;
            const angle = t * Math.PI * 6 + (j * Math.PI * 2 / 5);
            points.push(new THREE.Vector3(Math.cos(angle)*r, y, Math.sin(angle)*r));
        }
        treeGroup.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints(points), spiralMaterial));
    }

    // é¡¶éƒ¨æ˜Ÿæ˜Ÿ
    const star = new THREE.Mesh(
        new THREE.IcosahedronGeometry(0.35, 0),
        new THREE.MeshBasicMaterial({ color: 0xffdf99 })
    );
    star.position.set(0, 5.1, 0);
    treeGroup.add(star);

    const glow = new THREE.Sprite(new THREE.SpriteMaterial({
        map: createCircleTexture(), color: 0xffdf99, transparent: true, opacity: 0.5
    }));
    glow.scale.set(2, 2, 1);
    star.add(glow);

    // --- 3. ç¥ç¦æ–‡å­— ---
    function createTextLabel(text) {
        const canvas = document.createElement('canvas');
        canvas.width = 2048; // å¢åŠ å®½åº¦é˜²æ­¢æˆªæ–­
        canvas.height = 512;
        const ctx = canvas.getContext('2d');

        ctx.font = "Bold 90px Arial";
        ctx.fillStyle = "rgba(255, 215, 0, 1)";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.shadowColor = "rgba(0,0,0,1)";
        ctx.shadowBlur = 15;

        ctx.fillText(text, 1024, 256); // å±…ä¸­ç»˜åˆ¶

        const texture = new THREE.CanvasTexture(canvas);
        texture.anisotropy = renderer.capabilities.getMaxAnisotropy();

        const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture, transparent: true }));
        sprite.scale.set(8, 2, 1); // ä¿æŒå®½é«˜æ¯”
        sprite.position.set(0, 1.2, 2.5);
        return sprite;
    }

    const greetingText = createTextLabel("Merry Christmas To Miss LPY");
    treeGroup.add(greetingText);

    // --- 4. ç¯å¢ƒæ•ˆæœ (é›ªèŠ±ä¸åœ°é¢) ---
    const snowGeo = new THREE.BufferGeometry();
    const snowCount = 600;
    const snowPos = [];
    const snowSpeeds = [];

    for(let i=0; i<snowCount; i++) {
        snowPos.push((Math.random()-0.5)*15, Math.random()*10, (Math.random()-0.5)*15);
        snowSpeeds.push(0.02 + Math.random() * 0.04);
    }
    snowGeo.setAttribute('position', new THREE.Float32BufferAttribute(snowPos, 3));
    const snowSystem = new THREE.Points(snowGeo, new THREE.PointsMaterial({
        color: 0xffffff, size: 0.15, transparent: true, opacity: 0.8, map: createCircleTexture(), depthWrite: false
    }));
    scene.add(snowSystem);

    // åœ°é¢ç½‘æ ¼
    const groundGeo = new THREE.PlaneGeometry(30, 30, 32, 32);
    const posAttr = groundGeo.attributes.position;
    for (let i = 0; i < posAttr.count; i++) {
        posAttr.setZ(i, posAttr.getZ(i) + Math.random() * 0.3);
    }
    groundGeo.computeVertexNormals();
    const ground = new THREE.Mesh(groundGeo, new THREE.MeshBasicMaterial({ color: 0x112244, transparent:true, opacity:0.4, wireframe:true }));
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -0.5;
    scene.add(ground);

    // --- 5. åŠ¨ç”»ä¸äº¤äº’å¾ªç¯ ---
    function animate() {
        requestAnimationFrame(animate);
        controls.update();

        // åŠ¨æ€æ—‹è½¬
        treeGroup.rotation.y += 0.003;
        star.rotation.y -= 0.02;

        // é›ªèŠ±ä¸‹è½
        const positions = snowSystem.geometry.attributes.position.array;
        for(let i=0; i<snowCount; i++) {
            positions[i*3 + 1] -= snowSpeeds[i];
            if (positions[i*3 + 1] < -0.5) positions[i*3 + 1] = 10;
        }
        snowSystem.geometry.attributes.position.needsUpdate = true;

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // ç”¨æˆ·ç‚¹å‡»å¯åŠ¨
    const overlay = document.getElementById('start-overlay');
    overlay.addEventListener('click', function() {
        this.style.opacity = '0';
        setTimeout(() => { this.style.display = 'none'; }, 1000);

        // å°è¯•æ’­æ”¾éŸ³ä¹
        document.getElementById('bgm').play().catch(console.error);
        animate();
    });
</script>
</body>
</html>